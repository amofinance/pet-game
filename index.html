<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æˆ‘çš„é›»å­å¯µç‰© - æœ€å°ç¯„ä¾‹</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
  <style>
    html, body { height: 100%; margin: 0; background:#0f172a; font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial; }
    #game { width: 100%; height: 100%; display: grid; place-items: center; }
    .hint { position: fixed; left: 12px; bottom: 12px; color: #cbd5e1; font-size: 12px; opacity: .9; }
    .hint kbd { background: #1e293b; padding: 2px 6px; border-radius: 6px; border:1px solid #334155; }
  </style>
</head>
<body>
  <div id="game"></div>
  <div class="hint">æ“ä½œï¼šæŒ‰ <kbd>F</kbd> é¤µé£Ÿï¼Œ<kbd>P</kbd> ç©è€ã€‚æˆ–é»æ“Šç•«é¢ä¸Šçš„æŒ‰éˆ•ã€‚</div>
  <script>
    // --- éŠæˆ²è¨­å®š ---
    const WIDTH = 800, HEIGHT = 520;

    const state = {
      hunger: 80,     // é£¢é¤“ï¼ˆ0-100ï¼Œè¶Šé«˜è¶Šé£½ï¼‰
      happiness: 70,  // å¿«æ¨‚ï¼ˆ0-100ï¼‰
      energy: 60,     // é«”åŠ›ï¼ˆ0-100ï¼‰
      age: 0,         // å¤©æ•¸
      alive: true,
    };

    // ç°¡æ˜“æŒä¹…åŒ–ï¼ˆlocalStorageï¼‰
    const saved = localStorage.getItem('pet-state-v1');
    if (saved) {
      try { Object.assign(state, JSON.parse(saved)); } catch {}
    }

    const saveState = () => localStorage.setItem('pet-state-v1', JSON.stringify(state));

    class MainScene extends Phaser.Scene {
      constructor() { super('main'); }
      preload() {}
      create() {
        const centerX = WIDTH/2, centerY = HEIGHT/2;

        // èƒŒæ™¯æ¼¸å±¤
        this.cameras.main.setBackgroundColor('#0f172a');
        const gBg = this.add.graphics();
        gBg.fillStyle(0x1f2937, 1).fillRoundedRect(32, 24, WIDTH-64, HEIGHT-96, 24);

        // å¯µç‰©ï¼ˆç°¡å–®çš„è‡‰ï¼‰
        this.pet = this.add.container(centerX, centerY-20);
        const g = this.add.graphics();
        g.fillStyle(0xfcd34d, 1).fillCircle(0, 0, 90);             // è‡‰
        g.fillStyle(0x1f2937, 1)
          .fillCircle(-30, -20, 10)                                 // å·¦çœ¼
          .fillCircle( 30, -20, 10);                                // å³çœ¼
        // å¾®ç¬‘
        g.lineStyle(6, 0x1f2937, 1); g.beginPath();
        g.arc(0, 10, 40, Phaser.Math.DegToRad(20), Phaser.Math.DegToRad(160));
        g.strokePath();
        this.pet.add(g);

        // ç”Ÿå‘½æ¢ UI
        this.ui = this.add.container(60, HEIGHT-60);
        const labelStyle = { fontFamily: 'system-ui', fontSize: '16px', color: '#e2e8f0' };
        const barWidth = WIDTH-120, barHeight = 12;
        const mkBar = (y, color) => {
          const bg = this.add.rectangle(0, y, barWidth, barHeight, 0x0b1220).setOrigin(0, 0.5).setStrokeStyle(1, 0x334155);
          const fg = this.add.rectangle(0, y, barWidth, barHeight, color).setOrigin(0, 0.5);
          return { bg, fg };
        };
        this.add.text(60, HEIGHT-96, 'ç‹€æ…‹', { fontSize: '18px', color:'#93c5fd' }).setOrigin(0,0.5);
        this.add.text(60, HEIGHT-130, 'æˆ‘çš„é›»å­å¯µç‰©', { fontSize: '22px', color:'#f1f5f9' }).setOrigin(0,0.5);

        this.hungerText = this.add.text(60, HEIGHT-50, 'é£¢é¤“', labelStyle).setOrigin(0,0.5);
        this.hungerBar = mkBar(HEIGHT-50, 0x34d399);
        this.happyText = this.add.text(60, HEIGHT-25, 'å¿«æ¨‚', labelStyle).setOrigin(0,0.5);
        this.happyBar = mkBar(HEIGHT-25, 0x60a5fa);
        this.energyText = this.add.text(60, HEIGHT-75, 'é«”åŠ›', labelStyle).setOrigin(0,0.5);
        this.energyBar = mkBar(HEIGHT-75, 0xfca5a5);

        // äº’å‹•æŒ‰éˆ•
        this.feedBtn = this.mkButton(centerX-120, HEIGHT-120, 'é¤µé£Ÿ', () => this.feed());
        this.playBtn = this.mkButton(centerX+120, HEIGHT-120, 'ç©è€', () => this.playWith());

        // éµç›¤å¿«æ·éµ
        this.input.keyboard.on('keydown-F', () => this.feed());
        this.input.keyboard.on('keydown-P', () => this.playWith());

        // æ¯ç§’è¡°æ¸›
        this.ticker = this.time.addEvent({ delay: 1000, loop: true, callback: () => this.tick() });

        // åˆå§‹åˆ·æ–°
        this.refreshUI();
      }

      mkButton(x, y, text, onClick) {
        const btn = this.add.container(x, y);
        const w = 120, h = 40;
        const r = this.add.rectangle(0, 0, w, h, 0x334155).setStrokeStyle(2, 0x475569).setInteractive({ useHandCursor: true });
        const t = this.add.text(0, 0, text, { color:'#e2e8f0', fontSize:'16px' }).setOrigin(0.5);
        r.on('pointerdown', () => { this.sound?.play?.('click'); onClick(); });
        r.on('pointerover', () => r.setFillStyle(0x3b4c6b));
        r.on('pointerout',  () => r.setFillStyle(0x334155));
        btn.add([r, t]);
        return btn;
      }

      feed() {
        if (!state.alive) return;
        state.hunger = Math.min(100, state.hunger + 18);
        state.energy = Math.min(100, state.energy + 6);
        state.happiness = Math.min(100, state.happiness + 4);
        this.petPulse(1.08);
        this.refreshUI();
        saveState();
      }

      playWith() {
        if (!state.alive) return;
        state.happiness = Math.min(100, state.happiness + 16);
        state.energy = Math.max(0, state.energy - 8);
        state.hunger = Math.max(0, state.hunger - 6);
        this.petPulse(1.12);
        this.refreshUI();
        saveState();
      }

      petPulse(scaleTo=1.1) {
        this.tweens.add({ targets: this.pet, scale: scaleTo, duration: 120, yoyo: true, ease: 'Sine.easeInOut' });
      }

      tick() {
        if (!state.alive) return;

        // è‡ªç„¶è¡°æ¸›
        state.hunger = Math.max(0, state.hunger - 1.2);
        state.happiness = Math.max(0, state.happiness - 0.7);
        state.energy = Math.max(0, state.energy - 0.6);

        // å¹´é½¡è¨ˆç®—ï¼šæ¯ 60 ç§’ +1 å¤©ï¼ˆæ–¹ä¾¿é«”é©—ï¼‰
        if ((this.ticker.getElapsed() / 1000) % 60 === 0) state.age += 1;

        // ç”Ÿå­˜åˆ¤å®š
        if (state.hunger <= 0 || state.energy <= 0) {
          state.alive = false;
          this.showGameOver();
        }

        this.refreshUI();
        saveState();
      }

      refreshUI() {
        const pctW = (v) => Math.max(0.0001, (v/100) * (WIDTH-120));
        this.hungerBar.fg.width = pctW(state.hunger);
        this.happyBar.fg.width  = pctW(state.happiness);
        this.energyBar.fg.width = pctW(state.energy);

        const mood = state.happiness > 70 ? 'è¶…é–‹å¿ƒ' : state.happiness > 40 ? 'æ™®é€š' : 'ä¸å¤ªé–‹å¿ƒ';
        const status = state.alive ? `å¹´é½¡ï¼š${state.age} å¤©ï½œç‹€æ…‹ï¼š${mood}` : 'ç‹€æ…‹ï¼šğŸ˜µ å·²æ­»äº¡ï¼ˆé»æ“Šç•«é¢ä»»æ„è™•é‡ç”Ÿï¼‰';
        if (!this.statusText) {
          this.statusText = this.add.text(WIDTH/2, 36, status, { fontSize:'18px', color:'#e2e8f0' }).setOrigin(0.5,0);
        } else {
          this.statusText.setText(status);
        }
      }

      showGameOver() {
        const overlay = this.add.rectangle(WIDTH/2, HEIGHT/2, WIDTH, HEIGHT, 0x000000, 0.55);
        const box = this.add.rectangle(WIDTH/2, HEIGHT/2, 420, 190, 0x111827).setStrokeStyle(2, 0x374151);
        this.add.text(WIDTH/2, HEIGHT/2 - 40, 'ä½ çš„å¯µç‰©å€’ä¸‹äº†â€¦', { fontSize:'22px', color:'#fca5a5' }).setOrigin(0.5);
        const tip = this.add.text(WIDTH/2, HEIGHT/2 + 10, 'é»æ“Šä»»æ„è™•é‡ç”Ÿä¸¦ç¹¼æ‰¿éƒ¨åˆ†å±¬æ€§', { fontSize:'14px', color:'#cbd5e1' }).setOrigin(0.5);
        this.input.once('pointerdown', () => {
          state.alive = true;
          state.hunger = 50; state.energy = 50; state.happiness = Math.max(30, state.happiness);
          this.refreshUI(); overlay.destroy(); box.destroy(); tip.destroy();
        });
      }
    }

    const config = {
      type: Phaser.AUTO,
      width: WIDTH,
      height: HEIGHT,
      parent: 'game',
      backgroundColor: '#0f172a',
      scene: [MainScene],
    };

    new Phaser.Game(config);
  </script>
</body>
</html>